version: "1"

templates:
  - name: slack
    source: git.target.com/TargetOSS/vela-templates/slack/slack.yml@master
    type: github
  - name: build-release
    source: git.target.com/TargetOSS/vela-templates/libraries/build_release_template.yml@master
    type: github

secrets:
  - name: artifactory_username
    key: TargetOSS/artifactory_username
    engine: native
    type: org
  - name: artifactory_password
    key: TargetOSS/artifactory_password
    engine: native
    type: org
  - name: slack_webhook
    key: TargetOSS/slack_webhook
    engine: native
    type: org

steps:
  - name: build-release
    template:
      name: build-release
      vars:
        env:
          JAVA_TOOL_OPTIONS: -Xmx3000M
        build_command: java -version; ./gradlew clean build --stacktrace --info || cat /vela/src/git.target.com/TargetOSS/native_memory_allocator/build/reports/tests/test/index.html
        buildReleaseImage: library/openjdk:11-jdk

